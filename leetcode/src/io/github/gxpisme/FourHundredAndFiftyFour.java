package io.github.gxpisme;

import java.util.*;
import java.util.stream.Collectors;

/**
 * https://leetcode.com/problems/4sum-ii/
 *
 * Given four integer arrays nums1, nums2, nums3, and nums4 all of length n, return the number of tuples (i, j, k, l) such that:
 *      0 <= i, j, k, l < n
 *      nums1[i] + nums2[j] + nums3[k] + nums4[l] == 0
 * Example 1:
 *      Input: nums1 = [1,2], nums2 = [-2,-1], nums3 = [-1,2], nums4 = [0,2]
 *      Output: 2
 * Explanation:
 *      The two tuples are:
 *      1. (0, 0, 0, 1) -> nums1[0] + nums2[0] + nums3[0] + nums4[1] = 1 + (-2) + (-1) + 2 = 0
 *      2. (1, 1, 0, 0) -> nums1[1] + nums2[1] + nums3[0] + nums4[0] = 2 + (-1) + (-1) + 0 = 0
 * Example 2:
 *      Input: nums1 = [0], nums2 = [0], nums3 = [0], nums4 = [0]
 *      Output: 1
 *
 * Constraints:
 *      n == nums1.length
 *      n == nums2.length
 *      n == nums3.length
 *      n == nums4.length
 *      1 <= n <= 200
 *      -228 <= nums1[i], nums2[i], nums3[i], nums4[i] <= 228
 */
public class FourHundredAndFiftyFour {

    public static void main(String[] args) {
        /**
         * [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
         * [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
         * [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
         * [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
         */
//        int[] nums1 = {1, 2, 1};
//        int[] nums2 = {-2, -1};
//        int[] nums3 = {-1, 2};
//        int[] nums4 = {0,2};

//        int[] nums1 = {-268435121,-268434818,-268435384,-268434504,-268434852,-268434847,-268434718,-268434830,-268434644,-268434843,-268435282,-268434756,-268435098,-268435361,-268434888,-268435198,-268434771,-268435001,-268435011,-268434745,-268434892,-268435442,-268434705,-268434932,-268435095,-268434829,-268435166,-268434672,-268434959,-268434886,-268435158,-268435439,-268434665,-268434561,-268435327,-268434478,-268434879,-268434902,-268435027,-268434922,-268435028,-268434950,-268435407,-268434916,-268435326,-268435048,-268435156,-268435043,-268434607,-268434738,-268434944,-268434813,-268435194,-268434793,-268435372,-268434483,-268434761,-268434571,-268434529,-268435314,-268434733,-268435218,-268434590,-268434520,-268435372,-268435180,-268435420,-268435360,-268435316,-268435455,-268434797,-268435008,-268434540,-268434816,-268434485,-268435238,-268434559,-268434589,-268435257,-268434877,-268435455,-268435128,-268435307,-268434919,-268434893,-268435239,-268434788,-268435176,-268434930,-268434582,-268434471,-268435206,-268434561,-268434880,-268435137,-268434504,-268434549,-268434825,-268434587,-268435293};
//        int[] nums2 = {-268434497,-268435316,-268435433,-268434992,-268435391,-268434629,-268434902,-268434629,-268434895,-268434527,-268434822,-268435325,-268434634,-268434877,-268434758,-268434758,-268435109,-268435179,-268434736,-268435111,-268435243,-268435191,-268435091,-268435041,-268435231,-268434473,-268434656,-268435379,-268435127,-268434727,-268435302,-268434643,-268435101,-268434879,-268434848,-268434880,-268434817,-268434746,-268435005,-268435018,-268434535,-268435390,-268435430,-268434486,-268434497,-268434652,-268434816,-268435055,-268435296,-268435044,-268434939,-268435267,-268435283,-268434673,-268435298,-268435069,-268435041,-268434525,-268435023,-268435064,-268434969,-268434630,-268435197,-268435049,-268434496,-268434777,-268434928,-268434683,-268434923,-268434699,-268434634,-268434613,-268435438,-268435449,-268434498,-268435183,-268434577,-268434515,-268435100,-268435023,-268435214,-268435358,-268435394,-268434734,-268434636,-268435056,-268434829,-268434962,-268434673,-268434578,-268434850,-268435294,-268434752,-268435410,-268434841,-268434952,-268435111,-268434905,-268434791,-268434507};
//        int[] nums3 = {268434624,268434831,268435028,268434547,268435027,268435453,268435101,268435378,268435107,268434991,268435147,268435379,268435435,268435439,268435003,268435440,268435454,268434786,268434521,268434678,268435125,268434685,268434482,268435042,268434486,268434521,268435003,268435086,268434786,268434762,268435384,268434577,268435199,268435020,268434709,268435006,268434820,268434830,268435208,268435448,268435274,268435438,268435082,268435140,268434465,268435324,268434645,268435032,268434567,268435057,268435161,268435246,268434515,268434880,268435432,268434905,268435135,268435436,268434923,268435110,268434607,268435286,268435281,268434717,268435367,268434894,268435280,268434880,268435181,268434971,268435316,268435021,268435208,268434589,268434811,268434774,268434843,268434762,268434650,268435068,268434731,268435192,268434596,268434549,268434535,268435372,268435361,268435224,268435033,268434807,268435003,268434647,268435051,268434464,268435326,268434991,268434571,268435192,268435435,268435181};
//        int[] nums4 = {268434917,268435022,268435311,268434898,268435389,268435347,268434735,268435285,268434695,268434794,268435393,268435114,268435063,268434517,268434464,268434766,268435316,268434706,268434962,268435078,268434921,268435070,268434569,268434895,268435446,268435003,268435362,268435421,268435158,268435274,268435391,268435298,268435311,268435295,268435428,268435010,268434884,268435055,268434824,268434877,268434467,268435181,268434797,268435142,268434611,268434719,268435081,268434924,268435340,268434961,268435215,268434583,268435192,268435364,268434925,268435396,268434599,268435330,268435253,268435037,268434642,268435228,268435103,268434736,268435123,268435220,268435394,268435015,268434906,268434478,268434956,268434465,268434840,268434648,268434706,268435382,268435297,268434602,268435264,268435237,268434582,268434686,268434825,268435246,268435234,268435441,268435139,268435357,268434512,268435375,268434873,268435318,268434469,268434750,268435217,268434469,268434872,268435218,268435254,268434547};

//        int[] nums1 = {90,89,27,-78,51,-57,-14,42,65,-3,-31,82,-95,40,83,-73,-75,30,-42,29,97,85,25,-46,-57,45,-30,-67,80,20,-72,-34,18,-27,43,-21,22,5,3,-5,-21,44,-95,57,-36,-46,-15,-45,72,-77,-46,5,-23,-35,18,61,79,43,-43,-83,-83,-29,12,-36,13,-56,-22,-76,20,-48,23,80,-59,-86,-69,20,90,47,-79,-30,97,-9,63,86,3,5,-39,85,-4,-92,-38,-31,-75,-90,0,1,-8,53,81,45,44,35,15,27,75,66,72,-44,24,62,-29,-36,57,-30,23,61,-23,75,-41,48,-35,-32,15,-36,-86,78,38,6,45,-22,-22,94,68,-88,41,-70,23,-40,18,-13,7,-63,85,-86,-32,-66,-50,72,-75,74,-73,13,-72,35,79};
//        int[] nums2 = {71,-83,90,24,61,-7,-78,-36,-93,1,-69,-83,-100,-74,-21,77,64,-54,-30,54,51,-55,70,-5,73,-33,88,-19,-56,62,8,-39,-60,76,-62,-24,61,-34,82,-68,-95,51,53,-10,-11,-29,-52,52,-92,-9,97,41,42,53,-64,99,-26,62,65,-99,46,-100,-15,31,70,15,17,27,-43,66,-55,16,97,63,-91,-97,67,-88,-16,36,-52,32,83,-51,-19,-54,-99,-3,15,4,2,3,71,-69,-95,32,81,-45,-4,51,11,8,0,89,-28,-63,29,-15,-51,54,-48,-83,-44,-54,-81,-59,41,23,-16,-95,54,-97,-12,54,-26,-71,4,-60,-57,-43,-54,8,20,25,-48,29,-70,6,51,-23,32,40,88,-16,-71,97,64,36,-78,-52,46,56,-7,89,-14};
//        int[] nums3 = {-42,23,18,26,41,8,-20,12,-33,-76,-37,17,18,-1,71,51,-40,96,-20,-31,-83,78,-86,-63,-42,-49,-55,-79,9,84,-60,-65,-74,84,93,97,-32,-80,-3,94,25,100,-93,18,42,-37,-55,-93,98,35,-44,-89,-23,55,46,53,-58,10,62,4,62,88,79,-35,84,0,-4,-49,74,82,-19,-5,-52,-41,34,30,42,-20,34,4,35,-99,-97,0,90,22,83,-97,62,1,90,51,19,-83,41,37,60,-86,78,79,15,-80,28,15,81,40,55,73,52,3,19,89,8,42,-42,12,80,-40,6,69,-44,-5,82,88,-79,2,57,-90,-37,51,2,35,44,-84,-57,-79,-64,79,-53,-49,-19,-93,-36,19,68,0,-57,81,-27,24,85,46,17,-12,-36};
//        int[] nums4 = {5,-65,-8,5,-15,-33,46,83,-1,57,-98,90,81,-76,27,26,80,-11,93,-58,76,-3,28,66,-19,-59,-74,-27,-7,8,22,-84,44,56,50,-31,47,51,-64,79,-52,-99,-87,-90,-40,-3,-69,-10,64,-37,-32,77,68,16,-2,8,-14,-89,32,-93,-70,63,70,-60,83,-84,-77,-21,87,17,57,-22,47,-94,-95,-47,-89,-21,-1,-58,-60,-51,7,-71,-44,-45,-80,88,-46,-1,-18,-60,56,72,-87,43,-69,-20,72,28,-46,-4,88,52,48,68,21,-4,18,-23,-66,11,38,4,-52,65,-40,15,-31,44,60,98,-77,3,28,72,10,-78,-26,-45,66,-70,-82,-47,-43,-25,-26,40,-35,33,-22,30,-55,68,90,83,39,-48,51,-26,-100,29,38,-76,32};

         int[] nums1 = {-46,85,-20,42,63,-24,54,39,40,4,-82,-1,9,-56,-68,69,47,42,-81,1,89,59,-16,-65,-45,-50,-94,-40,-91,32,-75,-18,-75,48,45,80,-42,100,88,12,41,42,75,-6,-63,-68,40,-33,7,23,-24,96,52,68,67,-19,-100,65,43,1,-80,3,54,-28,44,-15,41,17,-42,83,-87,83,-45,-28,35,-8,-70,-95,36,-31,-29,-69,-48,-95,71,-90,-41,56,3,-20,-76,-69,-85,45,-33,-44,-96,-94,61,0,35,-74,66,-98,93,-65,-14,-21,-26,-21,-39,36,-82,62,24,37,21,-2,-26,62,24,33,-21,52,32,47,-33,-78,-82,-54,97,-58,11,52,71,-77,-95,-56,79,-92,-98,-37,64,32,62,-83,-97,-4,68,45,59,95,-8,30,-56,-40,85,93,32,-16,100,41,30,-81,-30,8,-73,-37,-98,-24,-16};
         int[] nums2 = {-98,67,42,33,95,-52,-78,76,46,58,-38,-86,74,-57,-98,-9,-12,43,-19,-8,30,56,-86,-64,-38,71,-73,-98,22,-77,-82,-1,-27,-10,24,36,-29,58,-77,39,23,62,-21,54,-82,-79,-48,14,66,-72,41,-34,-91,82,11,38,-86,-59,4,36,88,-4,91,21,34,-29,92,-77,-88,15,-85,57,87,-67,60,-73,7,-50,18,-34,87,-14,42,-39,-50,85,-99,41,2,-26,18,49,100,87,-90,48,32,-56,87,99,-97,35,20,15,-86,-70,-82,68,-43,38,62,-47,70,-31,94,-78,-77,-45,80,45,50,11,-42,81,68,85,70,39,-100,22,-56,-25,96,-20,-10,-75,15,-37,-82,-77,55,-11,54,-16,3,13,-83,53,84,26,-47,-70,83,-99,-18,-19,-20,88,-63,-90,68,51,-64,32,-38,6,85,-43,-62,-33,-77};
         int[] nums3 = {38,-48,59,-97,62,98,17,12,6,-32,-12,66,-54,-66,35,-67,-36,94,84,77,-33,-15,-61,89,90,79,10,95,-99,28,74,60,-64,-45,-25,32,5,18,-69,87,98,-57,13,89,-6,-16,-50,86,-90,-56,-29,-8,-66,-100,15,58,-78,42,99,-25,96,12,94,60,57,-99,69,-80,53,96,91,49,89,-65,-84,85,70,-68,-72,-8,-77,5,72,62,-3,-70,-2,21,-13,-80,26,-7,-73,-78,-32,-34,-27,-24,87,75,87,-54,96,-61,-36,93,-17,28,-35,-60,-69,-86,-13,40,43,77,-62,-24,19,44,-66,-2,-12,93,-17,-38,-22,-16,52,-15,-70,69,-92,-51,-79,91,-83,-27,-22,43,-30,35,76,68,88,61,34,-10,-96,-53,94,56,93,85,-21,80,67,90,-37,82,28,46,90,-50,-18,65,69,-83,-52,-75,-10};
         int[] nums4 = {34,-47,46,79,97,100,-43,65,31,32,58,54,-30,-58,-72,70,-47,78,-95,-83,42,63,46,72,-78,-29,78,-23,99,35,66,40,-14,-44,-48,-95,82,89,-43,0,72,-17,-79,66,-64,57,-91,20,-94,-74,97,-72,-77,0,98,47,-29,-53,37,-22,27,-70,18,90,-79,63,-90,38,-6,-78,-69,25,18,11,-95,-58,77,-68,65,31,16,-99,22,35,12,-33,22,-88,31,18,42,61,1,57,-81,6,98,9,53,38,-1,-22,-19,-34,96,-64,73,53,47,80,89,-49,-6,42,-82,-68,0,-91,94,93,49,78,55,-12,77,-93,64,57,46,5,55,40,9,38,8,43,-48,-80,62,79,-82,-54,-81,-75,6,75,59,55,-61,90,-32,16,20,96,46,34,75,92,-95,10,-62,-50,-92,-53,-33,25,69,40,62,-90,66};

        long start = System.currentTimeMillis();
        System.out.println(fourSumCount(nums1, nums2, nums3, nums4));
        System.out.println(System.currentTimeMillis() - start);
        System.out.println();

        long start0 = System.currentTimeMillis();
        System.out.println(fourSumCount3(nums1, nums2, nums3, nums4));
        System.out.println(System.currentTimeMillis() - start0);

        System.out.println();
        long start1 = System.currentTimeMillis();
        System.out.println(fourSumCount2(nums1, nums2, nums3, nums4));
        System.out.println(System.currentTimeMillis() - start1);
    }

    public static int fourSumCount(int[] nums1, int[] nums2, int[] nums3, int[] nums4) {
        HashMap<Integer, Integer> map1 = getMap(nums1);
        HashMap<Integer, Integer> map2 = getMap(nums2);
        HashMap<Integer, Integer> map3 = getMap(nums3);
        HashMap<Integer, Integer> map4 = getMap(nums4);

        List<Integer> fourList = map4.keySet().stream().collect(Collectors.toList());
        Collections.sort(fourList);

        HashMap<Integer, Boolean> targetMap = new HashMap<>();
        int totalCount = 0;
        for (int i : map1.keySet()) {
            for (int j : map2.keySet()) {
                for (int k : map3.keySet()) {
                    int target = 0 - i - j - k;
                    if (Objects.isNull(targetMap.get(target))) {
                        targetMap.put(target, binSearch(fourList, target));
                    }
                    if (targetMap.get(target)) {
                        int currentCount = map1.get(i) * map2.get(j) * map3.get(k) * map4.get(target);
                        totalCount = totalCount + currentCount;
                    }
                }
            }
        }
        return totalCount;
    }

    public static HashMap<Integer, Integer> getMap(int[] nums) {
        HashMap<Integer, Integer> result = new HashMap<>(nums.length);
        for (int i : nums) {
            Integer number = result.get(i);
            if (Objects.isNull(number)) {
                result.put(i, 1);
            } else {
                result.put(i, number + 1);
            }
        }
        return result;
    }

    /**
     * 二分查找
     * @param fourList
     * @param target
     * @return
     */
    public static Boolean binSearch(List<Integer> fourList, Integer target) {
        Integer left = 0;
        Integer right = fourList.size();
        while (left < right) {
            Integer middle = (left + right) / 2;
            if (fourList.get(middle).equals(target)) {
                return true;
            }
            // middle值 比 目标值大，则目标值在left和middle之间
            if (fourList.get(middle) > target) {
                right = middle;
            }
            // middle值 比 目标值小，则目标值在middle和right之间
            if (fourList.get(middle) < target) {
                left = middle + 1;
            }
        }
        return false;
    }

    public static int fourSumCount2(int[] nums1, int[] nums2, int[] nums3, int[] nums4) {
        Integer count = 0;
        for (int i : nums1) {
            for (int j : nums2) {
                for (int k : nums3) {
                    for (int l : nums4) {
                        if (i + j + k + l == 0) {
                            count++;
                        }
                    }
                }
            }
        }
        return count;
    }

    public static int fourSumCount3(int[] nums1, int[] nums2, int[] nums3, int[] nums4) {
        HashMap<Integer, Integer> map = new HashMap<>();

        for (int i : nums1) {
            for (int j : nums2) {
                map.put(i + j, map.getOrDefault(i + j, 0) + 1);
            }
        }

        Integer count = 0;
        for (int i : nums3) {
            for (int j : nums4) {
                int key = 0 - i - j;
                if (Objects.nonNull(map.get(key))) {
                    count = count + map.get(key);
                }
            }
        }
        return count;
    }
}
